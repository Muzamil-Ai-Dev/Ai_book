# Implementation Plan: Grounded RAG Chatbot

**Branch**: `008-rag-chatbot` | **Date**: 2025-12-19 | **Spec**: [specs/008-rag-chatbot/spec.md](spec.md)
**Input**: Feature specification for a grounded, non-hallucinating RAG chatbot for the AI-Native Textbook.

## Summary

This feature implements a Retrieval-Augmented Generation (RAG) chatbot using FastAPI, OpenAI ChatKit SDK, and Gemini. The system will ingest Docusaurus Markdown from `content/modules/`, chunk it deterministically, and store embeddings in a vector database. Retrieval will be strictly grounded via Context-7 MCP to ensure zero hallucinations and 100% adherence to textbook content.

## Technical Context

**Language/Version**: Python 3.11
**Primary Dependencies**: FastAPI, openai (ChatKit SDK), qdrant-client (or equivalent vector DB client), pydantic, langchain/llama-index (for chunking utilities)
**Storage**: Qdrant (Vector DB), Local/Cloud Storage (for source metadata)
**Testing**: pytest
**Target Platform**: Linux/Docker (FastAPI Backend)
**Project Type**: Web Backend (API)
**Performance Goals**: Query response < 5s; 100% source attribution
**Constraints**: Zero hallucinations (Constitution Principle VIII); No secrets in code (Constitution Principle IX)
**Scale/Scope**: Ingest 8 modules (~50-100 chapters); support multi-turn conversation

## Constitution Check

_GATE: Must pass before Phase 0 research. Re-check after Phase 1 design._

1.  **Principle VIII (Bounded Knowledge)**: The spec explicitly requires answering ONLY from book content and refusing out-of-scope questions. **PASS**
2.  **Principle IX (Zero Secrets)**: Plan assumes usage of `.env` for Gemini/OpenAI/Qdrant keys. **PASS**
3.  **Architecture (Directory Standard)**: Backend code will reside in `apps/api`. **PASS**

## Project Structure

### Documentation (this feature)

```text
specs/008-rag-chatbot/
├── plan.md              # This file
├── research.md          # Phase 0 output
├── data-model.md        # Phase 1 output
├── quickstart.md        # Phase 1 output
├── contracts/           # Phase 1 output
│   └── api.yaml         # OpenAPI spec
└── tasks.md             # To be generated by /sp.tasks
```

### Source Code (repository root)

```text
apps/api/
├── src/
│   ├── main.py          # FastAPI entry point
│   ├── models/          # Pydantic models (from data-model.md)
│   ├── services/        # RAG logic, Ingestion, ChatKit orchestration
│   ├── api/             # API Route handlers (from contracts/api.yaml)
│   └── utils/           # Chunking, Embeddings, Context-7 helpers
└── tests/
    ├── unit/
    └── integration/
```

**Structure Decision**: Confirmed usage of `apps/api` for the FastAPI backend, aligning with the Constitution's directory standard.

## Constitution Check (Post-Design)

1.  **Principle VIII (Bounded Knowledge)**: **STILL PASS**. The data model and API contracts explicitly include source metadata and refusal logic to enforce grounding.
2.  **Principle IX (Zero Secrets)**: **STILL PASS**. Quickstart and Technical Context mandate `.env` usage.
3.  **Architecture (Directory Standard)**: **STILL PASS**. Structure matches `apps/api` requirement.

## Complexity Tracking

> **Complexity is within acceptable bounds. No violations reported.**

## Complexity Tracking

> **Fill ONLY if Constitution Check has violations that must be justified**

| Violation                  | Why Needed         | Simpler Alternative Rejected Because |
| -------------------------- | ------------------ | ------------------------------------ |
| [e.g., 4th project]        | [current need]     | [why 3 projects insufficient]        |
| [e.g., Repository pattern] | [specific problem] | [why direct DB access insufficient]  |
